!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("planck-js")):"function"==typeof define&&define.amd?define(["exports","planck-js"],t):t(n.d3=n.d3||{},n.planck)}(this,function(n,t){"use strict";function e(n,t,e){var r=[];return n.descendants().filter(function(n){return n.depth===t}).forEach(function(n){let i=n.descendants().filter(function(n){return!n.children}),c=n.ancestors().filter(function(n){return n.depth===t})[0];i.forEach(function(n){let t=n.path(c).slice(1,-1),r=t.reduce(function(n,t){return n+t.uncertainty},0),o=c.uncertainty/2,u=n!==c?c.uncertainty:0,s=1===i.length?0:e/2;n.contourPadding=(n.depth-c.depth)*e+r+o,n.planckPadding=(n.depth-c.depth)*e+r+u+s}),r.push({nodes:i,parent:c})}),r}function r(n,t,r,c){d3.pack().radius(function(n){return n.r}).size([r,c])(n);for(let r=n.height-1;r>=0;r--){let c=e(n,r,t),u=[];c.forEach(function(n){u.push(n.parent.parent)}),u=u.unique(),u.forEach(function(n){let t=c.filter(function(t){return t.parent.parent===n}),e=[];t.forEach(function(n){e=e.concat(n.nodes)}),i(t,o(e))})}}function i(n,e){let r=t.World({gravity:t.Vec2(0,0)}),i=[];n.forEach(function(n){i.push(c(n,r))});let o=r.createBody(t.Vec2(e.x,e.y));i.forEach(function(n){let e=t.DistanceJoint({frequencyHz:.9,dampingRatio:.001},o,o.getPosition(),n,n.getPosition());e.m_length=0,r.createJoint(e)});for(let n=0;n<1e3;++n)r.step(1/60,6,2);for(let n=r.getBodyList();n;n=n.getNext())for(let e=n.getFixtureList();e;e=e.getNext())if(e.getShape().getType()===t.Circle.TYPE){let t=n.getWorldPoint(e.getShape().getCenter()),r=e.getUserData();r.x=t.x,r.y=t.y}}function c(n,e){let r=o(n.nodes),i=e.createDynamicBody(r),c={density:1,friction:1e-5};return n.nodes.forEach(function(n){let e=t.Vec2(n.x,n.y),o=e.sub(r);i.createFixture(t.Circle(o,n.r+n.planckPadding),c).setUserData(n)}),i}function o(n){let e=0,r=t.Vec2.zero();return n.forEach(function(n){let t=n.r*n.r*Math.PI;e+=t,r.x+=n.x*t,r.y+=n.y*t}),r.mul(1/e),r}function u(n,t){let e=0;n.children.forEach(function(n){n.descendants().forEach(function(n){n.color=t[e%t.length]}),e++})}function s(n,t){this.x=n,this.y=t,this.distance=function(n){var t=this.x-n.x,e=this.y-n.y;return Math.sqrt(t*t+e*e)},this.sub=function(n){return new s(this.x-n.x,this.y-n.y)},this.add=function(n){return new s(this.x+n.x,this.y+n.y)},this.scale=function(n){return new s(this.x*n,this.y*n)},this.angle=function(n){var t=Math.atan2(n.y,n.x)-Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.toUnitVector=function(){return this.scale(1/this.magnitude())}}function a(n,t,e,r,i){this.center=new s(n,t),this.startAngle=e,this.endAngle=r,this.radius=i}function h(n,t,e){this.center=new s(n,t),this.radius=e,this.intersects=function(n){var t=this.center.distance(n.center);return!(t>this.radius+n.radius)&&!(t<Math.abs(this.radius-n.radius))},this.intersectionPoints=function(n){var t=this.center,e=n.center,r=this.center.distance(n.center),i=(this.radius*this.radius-n.radius*n.radius+r*r)/(2*r),c=Math.sqrt(this.radius*this.radius-i*i),o=e.sub(t).scale(i/r).add(t),u=o.x+c*(e.y-t.y)/r,a=o.y-c*(e.x-t.x)/r,h=o.x-c*(e.y-t.y)/r,f=o.y+c*(e.x-t.x)/r;return[new s(u,a),new s(h,f)]}}function f(n,t){let e=[];n.forEach(function(n){e.push(new h(n.x,n.y,n.r+n.contourPadding))});let r=l(e,t),i=[];return i=i.concat(g(r)),i=i.concat(y(r,t)),p(i)}function d(n,t,e){let r=t[n],i=[];for(let e=0;e<t.length;e++)if(e!==n&&t[e].intersects(t[n])){let r=t[e].intersectionPoints(t[n]);i.push({intersectionPoint:r[0],circleIndex:e}),i.push({intersectionPoint:r[1],circleIndex:e})}let c=7,o=void 0;return i.forEach(function(n){let t=e.angle(n.intersectionPoint.sub(r.center));t>E&&t<c&&(c=t,o=n)}),o}function l(n,t){let e=n.map(function(n){return Object.assign({},n)});e.forEach(function(n){n.radius+=t});let r=0;for(let n=1;n<e.length;n++)e[n].center.x-e[n].radius<e[r].center.x-e[r].radius&&(r=n);let i=[],c=r,o=new s(-1,0);for(;;){let t=d(c,e,o);if(void 0===t)break;c=t.circleIndex;let r=n[c];if(o=t.intersectionPoint.sub(r.center),i[0]&&c===i[0].circleIndex&&t.intersectionPoint.distance(i[0].intersectionPoint)<E)break;i.push({circle:r,intersectionPoint:t.intersectionPoint,circleIndex:c})}return i}function g(n){let t=[];for(let e=0;e<n.length;e++){let r=n[e].circle,i=n[e].intersectionPoint,c=n[(e+1)%n.length].intersectionPoint,o=i.sub(r.center),u=c.sub(r.center),h=new s(0,-1).angle(o),f=new s(0,-1).angle(u);t.push(new a(r.center.x,r.center.y,h,f,r.radius))}return t}function y(n,t){let e=[];for(let r=0;r<n.length;r++){let i=n[r].intersectionPoint,c=n[r>0?r-1:n.length-1].circle,o=n[r].circle,u=c.center.sub(i),h=o.center.sub(i),f=new s(0,-1).angle(u),d=new s(0,-1).angle(h);e.push(new a(i.x,i.y,d,f,t))}return e}function p(n){let t=[],e=d3.arc();return n.forEach(function(n){let r=n.startAngle;r>n.endAngle&&(r-=2*Math.PI),t.push({d:e({innerRadius:n.radius,outerRadius:n.radius,startAngle:r,endAngle:n.endAngle}),transform:"translate("+n.center.x+","+n.center.y+")"})}),t}function x(n,t,r){let i=[];for(let c=n.height-1;c>=0;c--){let o=e(n,c,t);o.forEach(function(n){let t=f(n.nodes,r);t.forEach(function(t){t.strokeWidth=n.parent.uncertainty}),i=i.concat(t)})}return i}function P(){let n,t=10,e=10,i=[],c=800,o=800,s=[];return n={doColoring:function(){return u(s,i),n},doLayout:function(){return r(s,t,c,o),n},getContour:function(){return x(s,t,e)},hierarchyRoot:function(t){return arguments.length?(t.descendants().forEach(function(n){n.r||(n.r=n.value),n.uncertainty||(n.uncertainty=n.data.uncertainty)}),s=t,n):s},padding:function(e){return arguments.length?(t=+e,n):t},width:function(t){return arguments.length?(c=+t,n):c},height:function(t){return arguments.length?(o=+t,n):o},curvature:function(t){return arguments.length?(e=+t,n):e},colormap:function(t){return arguments.length?(i=t,n):i}}}Array.prototype.contains=function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return!0;return!1},Array.prototype.unique=function(){for(var n=[],t=0;t<this.length;t++)n.contains(this[t])||n.push(this[t]);return n};let E=1e-5;n.bubbletreemap=P,Object.defineProperty(n,"__esModule",{value:!0})});